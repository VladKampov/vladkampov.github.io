/*! by Vlad Kampov */
/*https://github.com/vladkampov/backbone-example */
!function(a){a(document).ready(function(){var b=[{id:"301",key:"0-{301}-0",make:"Ferrari",model:"Enzo",region:"Italy",price:"$500 000"}],c=Backbone.Model.extend({defaults:{id:"0",key:"0",make:"No make",model:"No model",region:"No region",price:"0"}}),d=Backbone.Collection.extend({model:c,localStorage:new Store("store-avtobazar")}),e=Backbone.View.extend({tagName:"div",className:"row",template:a("#thingTemplate").html(),render:function(){return tmpl=_.template(this.template),this.$el.html(tmpl(this.model.toJSON())),this},events:{"click a.delete":"deleteThing"},deleteThing:function(){this.model.destroy(),this.remove()}}),f=Backbone.View.extend({el:a("#things"),initialize:function(){this.collection=new d(b),this.collection.fetch(),this.render(),this.collection.on("add",this.renderThing,this),this.collection.on("remove",this.removeThing,this)},render:function(){this.$el.find("div.row").remove(),_.each(this.collection.models,function(a){this.renderThing(a)},this)},renderThing:function(a){var b=new e({model:a});this.$el.append(b.render().el)},events:{"click #add":"AddThing"},AddThing:function(d){d.preventDefault();var e=[];a("#AddingThing").find("input").each(function(b,c){""!==a(c).val()&&(e[c.id]=a(c).val(),a(c).val(""))});var f=0,g=0;a(b).each(function(a,b){f=parseInt(b.id),g=a}),f++,g++,e.id=f.toString(),e.key=g+"-{"+f+"}-"+g,(void 0===e.price||null===e.price)&&(e.price="0"),e.price="$"+e.price.replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "),b.push(e),newThing=new c(e),this.collection.add(newThing),newThing.save()},removeThing:function(a){var c=a.attributes;_.each(b,function(a){_.isEqual(a,c)&&b.splice(_.indexOf(b,a),1)})}});new f,a("#price").keydown(function(a){46==a.keyCode||8==a.keyCode||9==a.keyCode||27==a.keyCode||65==a.keyCode&&a.ctrlKey===!0||a.keyCode>=35&&a.keyCode<=39||(a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&a.preventDefault()})})}(jQuery);